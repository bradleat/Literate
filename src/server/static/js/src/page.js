// Generated by CoffeeScript 1.7.1
(function() {
  module.exports = function() {
    App.PageRoute = Ember.Route.extend({
      actions: {
        reload: function() {
          return this.refresh();
        }
      },
      model: function(params) {
        this.set('page', params.page_dir);
        return $.ajax({
          url: "/tangle/" + params.page_dir + "?mode=literate",
          cache: false
        });
      },
      setupController: function(controller, model) {
        var res;
        if (model.page_dir == null) {
          res = {
            model: model,
            page: this.get('page')
          };
          App.state.toLiterate(model, res.page);
          return controller.set('model', res);
        } else {
          return App.state.toLiterate(controller.content.model);
        }
      }
    });
    App.PageView = Ember.View.extend({
      didInsertElement: function() {
        return App.state.toLiterate(this.get('controller.content.model'), this.get('controller.content.page'));
      }
    });
    return App.PageController = Ember.ObjectController.extend({
      actions: {
        "toggle-editor": function() {
          return App.state.toggleEditor(this.get('page'));
        },
        "open-settings": function() {
          return App.state.openSettings();
        },
        "save-refresh": function() {
          return App.state.saveOrRefresh(this.get('page'), (function(_this) {
            return function(mode, page) {
              if (mode === 'reload') {
                return _this.send("reload");
              } else {
                return _this.transitionToRoute(mode, {
                  page_dir: page
                });
              }
            };
          })(this));
        },
        "literate-start": function() {
          return this.transitionToRoute('page', {
            page_dir: this.get('page')
          });
        },
        "markdown-start": function() {
          return this.transitionToRoute('markdown', {
            page_dir: this.get('page')
          });
        },
        "code-start": function() {
          return this.transitionToRoute('code', {
            page_dir: this.get('page')
          });
        }
      }
    });
  };

}).call(this);
